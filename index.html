<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>businesscat ar</title>
<script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image.prod.js?v=1"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js?v=1"></script>
<style>
  html,body{margin:0;height:100%;overflow:hidden;background:#000}
  #error{position:fixed;z-index:5;left:0;right:0;top:0;padding:12px 14px;font-size:14px;line-height:1.4;text-align:center;background:#111;color:#fff;display:none}
</style>
</head>
<body>
<div id="error"></div>

<a-scene id="scene"
  mindar-image="imageTargetSrc: targets.mind; autoStart: true; uiScanning: false; uiLoading: false"
  color-space="sRGB"
  renderer="antialias: true; colorManagement: true"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false">
  <a-assets>
    <a-asset-item id="cat" src="businesscat.glb"></a-asset-item>
  </a-assets>

  <a-entity light="type: ambient; intensity: 1"></a-entity>
  <a-entity light="type: directional; intensity: 0.9" position="0 1 0.5"></a-entity>

  <a-entity mindar-image-target="targetIndex: 0">
    <a-entity gltf-model="#cat" position="0 0 0.06" rotation="0 0 0" scale="0.12 0.12 0.12"></a-entity>
  </a-entity>

  <a-camera look-controls="enabled: false"></a-camera>
</a-scene>

<script>
  const box=document.getElementById("error");
  function show(msg){ box.textContent=msg; box.style.display="block"; }

  // targets.mind 존재 여부를 먼저 확인 (없거나 경로틀리면 바로 안내)
  (async ()=>{
    try{
      const r=await fetch("targets.mind",{method:"HEAD",cache:"no-store"});
      if(!r.ok) throw new Error("not-found");
    }catch(e){
      show("targets.mind를 찾을 수 없습니다. 파일명이 정확히 'targets.mind'인지, index.html과 같은 폴더에 있는지 확인하세요.");
    }
  })();

  const scene=document.getElementById("scene");
  scene.addEventListener("arError",e=>{
    const n=e?.detail?.error?.name;
    if(n==="NotAllowedError") show("카메라 권한이 거부되었습니다. Safari 주소창 → 웹 사이트 설정에서 카메라를 '허용'으로 바꾸고 새로고침하세요.");
    else if(n==="NotFoundError"||n==="OverconstrainedError") show("사용 가능한 카메라를 찾을 수 없습니다. 다른 기기나 브라우저로 시도하세요.");
    else if(n==="NotReadableError") show("카메라에 접근할 수 없습니다. 다른 앱이 카메라를 사용 중일 수 있습니다.");
    else if(n==="SecurityError") show("보안 정책으로 차단되었습니다. HTTPS로 접속했는지 확인하세요.");
    else show("카메라 초기화 중 오류가 발생했습니다.");
  });

  // 라이브러리/네트워크 문제로 초기화가 지연될 때 안내
  let timedOut=false;
  const t=setTimeout(()=>{ timedOut=true; show("초기화가 지연됩니다. 네트워크를 확인하고 잠시 후 다시 시도해 주세요."); }, 8000);
  scene.addEventListener("arReady",()=>{ if(!timedOut) { clearTimeout(t); box.style.display="none"; } });
  window.addEventListener("unhandledrejection",()=>show("라이브러리 로드 중 오류가 발생했습니다. 네트워크 상태를 확인하세요."));
</script>
</body>
</html>
