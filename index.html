<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Business Card AR</title>
  <style>
    html, body { margin:0; height:100%; overflow:hidden; background:#000; }
    #overlay { position:fixed; left:0; right:0; top:0; display:flex; gap:.5rem; align-items:center; padding:.6rem .8rem; color:#fff; font:14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji; background:linear-gradient(#0008,#0000); pointer-events:none; }
    #overlay b { font-weight:600 }
    #warn { position:fixed; left:50%; transform:translateX(-50%); bottom:.75rem; color:#fff; background:#000a; padding:.5rem .7rem; border-radius:.5rem; font:12px/1.3 system-ui; }
    .btn { position:fixed; right:.75rem; bottom:.75rem; padding:.5rem .75rem; border-radius:.5rem; font:12px/1.3 system-ui; color:#111; background:#fff; border:0; cursor:pointer; }
    .btn:active { transform:translateY(1px) }
  </style>
  <!-- A-Frame & MindAR (Image Tracking) -->
  <script src="https://cdn.jsdelivr.net/npm/aframe@1.6.0/dist/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
</head>
<body>
  <div id="overlay">ğŸ” <b>ëª…í•¨ì„ í™”ë©´ì— ê½‰ ì°¨ê²Œ ë³´ì´ë„ë¡ ë§ì¶° ë³´ì„¸ìš”.</b> ì¸ì‹ë˜ë©´ ê³ ì–‘ì´ ëª¨ë¸ì´ ìœ„ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</div>
  <div id="warn" hidden>ì¹´ë©”ë¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ í—ˆìš©í•˜ì„¸ìš”.</div>
  <button class="btn" id="recenter">Recenter</button>

  <!--
    í”„ë¡œì íŠ¸ íŒŒì¼ êµ¬ì„± (ë¦¬í¬ì§€í† ë¦¬ ë£¨íŠ¸):
      - index.html
      - businesscat.glb  (3D ìºë¦­í„°)
      - targets.mind      (MindAR ì´ë¯¸ì§€ íƒ€ê²Ÿ íŒŒì¼)
      - businesscard.jpg  (ì›ë³¸ ëª…í•¨ ì´ë¯¸ì§€)

    ì¤‘ìš”: 'businesscard.jpg'ë¡œë¶€í„° MindAR Image Target Compilerë¥¼ ì´ìš©í•´ 'targets.mind'ë¥¼ ìƒì„± í›„ ê°™ì€ í´ë”ì— ë‘ì„¸ìš”.
  -->

  <a-scene
    mindar-image="imageTargetSrc: ./targets.mind; filterMinCF: 0.0001; filterBeta: 0.001"
    embedded
    color-space="sRGB"
    renderer="colorManagement: true, physicallyCorrectLights: true, antialias: true"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false"
  >
    <a-assets>
      <!-- íŒŒì¼ëª…ì— ê³µë°± ì—†ìŒ: businesscat.glb -->
      <a-asset-item id="cat" src="./businesscat.glb"></a-asset-item>
    </a-assets>

    <!-- ì¡°ëª… -->
    <a-entity light="type: ambient; intensity: 0.6"></a-entity>
    <a-entity light="type: directional; intensity: 1.1" position="1 2 1"></a-entity>

    <!-- ì´ë¯¸ì§€ íƒ€ê²Ÿ(0ë²ˆ)ì— ëª¨ë¸ ë°°ì¹˜ -->
    <a-entity mindar-image-target="targetIndex: 0">
      <a-gltf-model src="#cat" position="0 0 0" rotation="0 0 0" scale="0.25 0.25 0.25" animation-mixer></a-gltf-model>
      <a-entity position="0 -0.01 0" geometry="primitive: circle; radius: 0.65" material="color: #111; opacity: 0.35; transparent: true"></a-entity>
    </a-entity>

    <!-- ì¹´ë©”ë¼ -->
    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
  </a-scene>

  <script>
    // ì¹´ë©”ë¼ ì˜¤ë¥˜ ì•ˆë‚´
    const sceneEl = document.querySelector('a-scene');
    const warn = document.getElementById('warn');
    sceneEl.addEventListener('absolutecameraerror', () => warn.hidden = false);

    // í™”ë©´ ì¤‘ì•™ ì¬ì •ë ¬
    document.getElementById('recenter').addEventListener('click', () => {
      const comp = sceneEl.systems['mindar-image'];
      if (comp && comp.mindar && comp.mindar.controller) {
        comp.mindar.controller.reset();
      }
    });

    // ì„±ëŠ¥ ìµœì í™”: ê³ í•´ìƒë„ ë””ë°”ì´ìŠ¤ í”½ì…€ë¹„ ì¡°ì •
    if (window.devicePixelRatio > 1.5) {
      const threeRenderer = sceneEl.renderer;
      sceneEl.addEventListener('loaded', () => {
        if (threeRenderer) threeRenderer.setPixelRatio(Math.min(2, window.devicePixelRatio));
      });
    }
  </script>
</body>
</html>
